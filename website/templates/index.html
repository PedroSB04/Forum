<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>DevForum</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
	<div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>
    
	<div class="container">
		<header class="header">
			<div class="logo">DevForum</div>
			<div class="hamburger" id="hamburger" onclick="toggleMenu()">
				<span></span>
				<span></span>
				<span></span>
			</div>
		</header>

		<nav class="mobile-menu" id="mobileMenu">
			<ul class="menu-list">
				<li class="menu-item">
					<a href="{{ url_for('views.home') }}" class="menu-link">
						🏠 Início
					</a>
				</li>
				<li class="menu-item">
					<a href="{{ url_for('auth.login') }}" class="menu-link">
						🔐 Entrar
					</a>
				</li>
				<li class="menu-item">
					<a href="{{ url_for('auth.signup') }}" class="menu-link">
						👤 Cadastrar
					</a>
				</li>
				<li class="menu-item">
					{% if current_user.is_authenticated %}
						<a href="{{ url_for('views.perfil', id_usuario=current_user.id_usuario) }}" class="menu-link">
							👤 Perfil
						</a>
					{% else %}
						<a href="{{ url_for('auth.login') }}" class="menu-link">
							👤 Perfil
						</a>
					{% endif %}
				</li>
			</ul>
		</nav>

		<div class="search-section">
			<div class="search-controls">
				<input type="text" class="search-input" placeholder="Buscar tópicos..." id="searchInput">
				<form method="get" id="filtrosForm" style="display:inline;">
					<select name="categoria" class="filter-select" onchange="document.getElementById('filtrosForm').submit();" style="margin-right:8px;">
						<option value="todas" {% if categoria_id == 'todas' %}selected{% endif %}>Todas as Categorias</option>
						{% for cat in categorias %}
							<option value="{{ cat.id_categoria }}" {% if categoria_id|int == cat.id_categoria %}selected{% endif %}>{{ cat.nome }}</option>
						{% endfor %}
					</select>
					<select name="ordem" class="filter-select" onchange="document.getElementById('filtrosForm').submit();">
						<option value="recentes" {% if ordem == 'recentes' %}selected{% endif %}>Mais recentes</option>
						<option value="antigos" {% if ordem == 'antigos' %}selected{% endif %}>Mais antigos</option>
					</select>
				</form>
			</div>
		</div>

		<div class="discussions-section">
			<div class="discussions-header-container">
				<h2 class="discussions-header">Discussões Recentes</h2>
				{% if current_user.is_authenticated %}
					<a href="{{ url_for('views.criar_post') }}" class="create-topic-button">
						✏️ Criar Tópico
					</a>
				{% else %}
					<a href="{{ url_for('auth.login') }}" class="create-topic-button">
						✏️ Criar Tópico
					</a>
				{% endif %}
			</div>

			<!-- Lista de Posts -->
			<div class="posts-list">
				{% if posts %}
					{% for post in posts %}
					<div class="post-card">
						<div class="post-header">
							<div class="post-author">
								{% if post.foto_perfil %}
									<img src="{{ post.foto_perfil }}" alt="Avatar" class="author-avatar">
								{% else %}
									<div class="author-avatar-placeholder">{{ post.username[0]|upper }}</div>
								{% endif %}
								<span class="author-name">{{ post.username }}</span>
								<span class="post-time">• {{ post.tempo_decorrido }}</span>
							</div>
						</div>
                        
						<div class="post-content">
							<h3 class="post-title">
								<a href="{{ url_for('views.discussao', post_raiz_id=post.id_post) }}">
									{{ post.titulo }}
								</a>
							</h3>
							<p class="post-preview">
								{{ post.conteudo[:200] }}{% if post.conteudo|length > 200 %}...{% endif %}
							</p>
						</div>
                        
						<div class="post-footer">
							<div class="post-stats">
								<span class="stat-item">
									💬 {{ post.total_respostas }} resposta{{ 's' if post.total_respostas != 1 else '' }}
								</span>
								{% if post.likes %}
								<span class="stat-item">
									👍 {{ post.likes }}
								</span>
								{% endif %}
							</div>
							<a href="{{ url_for('views.discussao', post_raiz_id=post.id_post) }}" class="view-discussion-btn">
								Ver discussão →
							</a>
						</div>
					</div>
					{% endfor %}
				{% else %}
					<div class="no-posts-message">
						<p>Ainda não há posts no fórum.</p>
						{% if current_user.is_authenticated %}
							<p>Seja o primeiro a <a href="{{ url_for('views.criar_post') }}">criar um tópico</a>!</p>
						{% else %}
							<p><a href="{{ url_for('auth.login') }}">Faça login</a> para criar o primeiro tópico!</p>
						{% endif %}
					</div>
				{% endif %}
			</div>
		</div>

		<div class="info-section">
			<div class="info-header">Sobre o DevForum</div>
			<div class="info-content">
				Um fórum dirigido pela comunidade onde desenvolvedores compartilham conhecimento, discutem tecnologias e se ajudam a crescer.
				<form action="{{ url_for('auth.signup') }}" method="get">
					<button type="submit" class="join-button">Junte-se à Comunidade</button>
				</form>
			</div>
		</div>
	</div>

	<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
